name: Deployment Development

on:
  workflow_dispatch:
  push:
    branches: [ dev ]

jobs:
  web-deploy:
    name: Deploy Fullstack Application
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšš Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'
          extensions: intl, mbstring, xml, curl

      - name: ğŸ“¦ Install Composer Dependencies
        run: composer install --no-dev --no-scripts --prefer-dist --no-interaction

      - name: setup node.js
        uses: actions/setup-node@v3
        with:
          node-version: "22"

      - name: ğŸ—ï¸ Install NPM Dependencies & Build
        run: |
          npm ci --no-audit --no-fund
          npm run build

      - name: ğŸ— Install LFTP
        run: |
          sudo apt-get update
          sudo apt-get install -y lftp

      - name: ğŸš€ FTP Mirror (lftp)
        env:
          FTP_USER: ${{ secrets.ftp_username }}
          FTP_PASS: ${{ secrets.ftp_password }}
          FTP_HOST: ${{ secrets.ftp_server }}
        run: |
          lftp -u "$FTP_USER","$FTP_PASS" "$FTP_HOST" <<EOF
          set ftp:passive-mode true
          set ftp:list-options -a
          mirror -R \
            --delete \
            --parallel=5 \
            --exclude-glob-from=.ftpignore \
            ./ /
          quit
          EOF
